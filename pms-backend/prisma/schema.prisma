generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model State {
  stateId   String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code      String     @unique
  name      String     @unique
  type      StateType
  createdAt DateTime   @default(now()) @db.Timestamptz(6)
  updatedAt DateTime   @updatedAt @db.Timestamptz(6)
  companies Company[]
  districts District[]
  projects  Project[]
  users     User[]

  @@map("State")
}

model District {
  districtId String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name       String
  stateId    String    @db.Uuid
  createdAt  DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt  DateTime  @updatedAt @db.Timestamptz(6)
  companies  Company[]
  state      State     @relation(fields: [stateId], references: [stateId], onDelete: Cascade)
  projects   Project[]
  users      User[]

  @@unique([stateId, name])
  @@map("District")
}

model User {
  userId                     String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code                       String?              @unique
  firstName                  String
  middleName                 String?
  lastName                   String?
  countryCode                String
  phone                      String
  email                      String?              @unique
  preferredLanguage          PreferredLanguage?
  profilePhoto               String?
  stateId                    String?              @db.Uuid
  districtId                 String?              @db.Uuid
  cityTown                   String?
  pin                        String?
  operatingZone              OperatingZone?
  address                    String?
  isClient                   Boolean?             @default(false)
  isServiceProvider          Boolean?             @default(false)
  userStatus                 UserStatus           @default(Active)
  passwordHash               String?
  isSuperAdmin               Boolean?             @default(false)
  createdAt                  DateTime             @default(now()) @db.Timestamptz(6)
  updatedAt                  DateTime             @updatedAt @db.Timestamptz(6)
  userRole                   UserRole?
  companiesAsServiceProvider Company[]            @relation("CompanyServiceProviderUser")
  projectsAsClient           Project[]            @relation("ProjectClientUser")
  district                   District?            @relation(fields: [districtId], references: [districtId])
  state                      State?               @relation(fields: [stateId], references: [stateId])
  userCompanies              UserCompany[]
  userProjects               UserProject[]
  userRoleMemberships        UserRoleMembership[]
  wirsBic                    Wir[]                @relation("WirBicUser")
  wirAsContractor            Wir[]                @relation("WirContractorUser")
  wirsCreated                Wir[]                @relation("WirCreatedBy")
  wirAsHod                   Wir[]                @relation("WirHodUser")
  wirAsInspector             Wir[]                @relation("WirInspectorUser")
  wirsRescheduled            Wir[]                @relation("WirRescheduledByUser")
  WirDiscussion              WirDiscussion[]

  @@unique([countryCode, phone], map: "User_cc_phone_unique")
  @@map("User")
}

model Company {
  companyId           String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                String
  status              CompanyStatus        @default(Active)
  website             String?
  companyRole         CompanyRole?
  gstin               String?              @unique
  pan                 String?              @unique
  cin                 String?              @unique
  primaryContact      String?
  contactMobile       String?
  contactEmail        String?
  stateId             String?              @db.Uuid
  districtId          String?              @db.Uuid
  address             String?
  pin                 String?
  notes               String?
  userId              String?              @db.Uuid
  companyCode         String?              @unique
  createdAt           DateTime             @default(now()) @db.Timestamptz(6)
  updatedAt           DateTime             @updatedAt @db.Timestamptz(6)
  district            District?            @relation(fields: [districtId], references: [districtId])
  state               State?               @relation(fields: [stateId], references: [stateId])
  serviceProvider     User?                @relation("CompanyServiceProviderUser", fields: [userId], references: [userId], onDelete: Cascade)
  projects            Project[]            @relation("ProjectClientCompany")
  userCompanies       UserCompany[]
  userRoleMemberships UserRoleMembership[]

  @@map("Company")
}

model Project {
  projectId                 String                      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title                     String
  code                      String?                     @unique
  status                    ProjectStatus               @default(Draft)
  stage                     ProjectStage?
  projectType               ProjectType?
  structureType             StructureType?
  constructionType          ConstructionType?
  contractType              ContractType?
  health                    ProjectHealth               @default(Unknown)
  clientUserId              String?                     @db.Uuid
  clientCompanyId           String?                     @db.Uuid
  address                   String?
  cityTown                  String?
  stateId                   String?                     @db.Uuid
  districtId                String?                     @db.Uuid
  pin                       String?
  latitude                  Decimal?                    @db.Decimal(9, 6)
  longitude                 Decimal?                    @db.Decimal(9, 6)
  startDate                 DateTime?
  plannedCompletionDate     DateTime?
  currency                  CurrencyCode?               @default(INR)
  contractValue             Decimal?                    @db.Decimal(18, 2)
  areaUnit                  AreaUnit?
  plotArea                  Decimal?                    @db.Decimal(14, 2)
  builtUpArea               Decimal?                    @db.Decimal(14, 2)
  floors                    Int?
  description               String?
  createdAt                 DateTime                    @default(now()) @db.Timestamptz(6)
  updatedAt                 DateTime                    @updatedAt @db.Timestamptz(6)
  PermissionProjectOverride PermissionProjectOverride[]
  clientCompany             Company?                    @relation("ProjectClientCompany", fields: [clientCompanyId], references: [companyId])
  clientUser                User?                       @relation("ProjectClientUser", fields: [clientUserId], references: [userId])
  district                  District?                   @relation(fields: [districtId], references: [districtId])
  state                     State?                      @relation(fields: [stateId], references: [stateId])
  moduleSettings            ProjectModuleSetting[]
  projectTags               ProjectTag[]
  userProjects              UserProject[]
  userRoleMemberships       UserRoleMembership[]
  wirs                      Wir[]

  @@map("Project")
}

model RefProjectTag {
  tagCode String       @id
  label   String
  tags    ProjectTag[]

  @@map("ref_project_tag")
}

model ProjectTag {
  projectId String        @db.Uuid
  tagCode   String
  project   Project       @relation(fields: [projectId], references: [projectId], onDelete: Cascade)
  tag       RefProjectTag @relation(fields: [tagCode], references: [tagCode])

  @@id([projectId, tagCode])
  @@map("ProjectTag")
}

model UserProject {
  userId    String   @db.Uuid
  projectId String   @db.Uuid
  createdAt DateTime @default(now()) @db.Timestamptz(6)
  project   Project  @relation(fields: [projectId], references: [projectId], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@id([userId, projectId])
  @@index([userId])
  @@index([projectId])
  @@map("UserProject")
}

model UserCompany {
  userId    String   @db.Uuid
  companyId String   @db.Uuid
  createdAt DateTime @default(now()) @db.Timestamptz(6)
  company   Company  @relation(fields: [companyId], references: [companyId], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@id([userId, companyId])
  @@index([userId])
  @@index([companyId])
  @@map("UserCompany")
}

model UserRoleMembership {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId     String    @db.Uuid
  role       UserRole
  scopeType  RoleScope
  companyId  String?   @db.Uuid
  projectId  String?   @db.Uuid
  isDefault  Boolean   @default(false)
  canApprove Boolean   @default(false)
  validFrom  DateTime? @db.Timestamptz(6)
  validTo    DateTime? @db.Timestamptz(6)
  createdBy  String?   @db.Uuid
  notes      String?
  createdAt  DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt  DateTime  @updatedAt @db.Timestamptz(6)
  company    Company?  @relation(fields: [companyId], references: [companyId], onDelete: Cascade)
  project    Project?  @relation(fields: [projectId], references: [projectId], onDelete: Cascade)
  user       User      @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@unique([userId, projectId, role, validFrom, validTo], map: "urm_unique_user_project_role_window")
  @@index([userId, role])
  @@index([companyId])
  @@index([projectId])
  @@index([projectId, role, validFrom, validTo], map: "urm_project_role_window_idx")
  @@index([userId, role, validFrom, validTo], map: "urm_user_role_window_idx")
  @@map("UserRoleMembership")
}

model PermissionTemplate {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  role      UserRole @unique
  matrix    Json
  createdAt DateTime @default(now()) @db.Timestamptz(6)
  updatedAt DateTime @updatedAt @db.Timestamptz(6)

  @@map("PermissionTemplate")
}

model PermissionProjectOverride {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  projectId String   @db.Uuid
  role      UserRole
  matrix    Json
  createdAt DateTime @default(now()) @db.Timestamptz(6)
  updatedAt DateTime @updatedAt @db.Timestamptz(6)
  project   Project  @relation(fields: [projectId], references: [projectId], onDelete: Cascade)

  @@unique([projectId, role], map: "ppo_project_role_unique")
  @@map("PermissionProjectOverride")
}

model PermissionUserOverride {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  projectId String
  userId    String
  matrix    Json
  createdAt DateTime @default(now()) @db.Timestamptz(6)
  updatedAt DateTime @updatedAt @db.Timestamptz(6)

  @@unique([projectId, userId], map: "puo_project_user")
  @@map("PermissionUserOverride")
}

model RefChecklist {
  id                String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code              String?            @unique
  title             String
  discipline        Discipline
  stageLabel        String?
  tags              String[]           @default([])
  status            String             @default("Active")
  version           Int                @default(1)
  versionLabel      String?
  versionMajor      Int                @default(1)
  versionMinor      Int                @default(0)
  versionPatch      Int                @default(0)
  aiDefault         Boolean            @default(false)
  createdAt         DateTime           @default(now()) @db.Timestamptz(6)
  updatedAt         DateTime           @updatedAt @db.Timestamptz(6)
  items             RefChecklistItem[]
  WirChecklist      WirChecklist[]
  checklistWirItems WirItem[]          @relation("WirItem_checklist")
  sourceWirItems    WirItem[]          @relation("WirItem_sourceChecklist")

  @@index([discipline, stageLabel])
  @@map("RefChecklist")
}

model RefChecklistItem {
  id                  String                         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  checklistId         String                         @db.Uuid
  seq                 Int
  text                String
  requirement         String?
  method              String[]
  risk                String?
  tags                String[]
  itemCode            String?
  critical            Boolean?
  aiEnabled           Boolean?
  aiConfidence        Decimal?
  units               String?
  tolerance           String?
  base                Decimal?
  plus                Decimal?
  minus               Decimal?
  checklist           RefChecklist                   @relation(fields: [checklistId], references: [id], onDelete: Cascade)
  suggestedActivities RefChecklistItemActivityLink[]
  suggestedMaterials  RefChecklistItemMaterialLink[]
  itemWirItems        WirItem[]                      @relation("WirItem_item")
  sourceWirItems      WirItem[]                      @relation("WirItem_sourceItem")

  @@index([checklistId])
  @@map("RefChecklistItem")
}

model RefChecklistItemActivityLink {
  id         String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  itemId     String           @db.Uuid
  activityId String?          @db.Uuid
  label      String
  tags       String[]
  activity   RefActivity?     @relation(fields: [activityId], references: [id])
  item       RefChecklistItem @relation(fields: [itemId], references: [id], onDelete: Cascade)

  @@index([itemId])
  @@index([activityId])
  @@map("RefChecklistItemActivityLink")
}

model RefChecklistItemMaterialLink {
  id         String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  itemId     String           @db.Uuid
  materialId String?          @db.Uuid
  name       String
  category   String?
  properties Json?
  item       RefChecklistItem @relation(fields: [itemId], references: [id], onDelete: Cascade)
  material   RefMaterial?     @relation(fields: [materialId], references: [id])

  @@index([itemId])
  @@index([materialId])
  @@map("RefChecklistItemMaterialLink")
}

model RefActivity {
  id                           String                         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code                         String?                        @unique
  title                        String
  discipline                   Discipline
  stageLabel                   String?
  phase                        String[]                       @default([])
  element                      String[]                       @default([])
  system                       String[]
  nature                       String[]
  method                       String[]
  status                       String                         @default("Active")
  version                      Int                            @default(1)
  versionLabel                 String?
  versionMajor                 Int                            @default(1)
  versionMinor                 Int                            @default(0)
  versionPatch                 Int                            @default(0)
  notes                        String?
  createdAt                    DateTime                       @default(now()) @db.Timestamptz(6)
  updatedAt                    DateTime                       @updatedAt @db.Timestamptz(6)
  materials                    RefActivityMaterial[]
  RefChecklistItemActivityLink RefChecklistItemActivityLink[]

  @@unique([discipline, stageLabel, title], map: "refactivity_uq_disc_stage_title")
  @@map("RefActivity")
}

model RefMaterial {
  id                           String                         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code                         String?                        @unique
  name                         String
  discipline                   MaterialDiscipline?
  category                     String?
  manufacturer                 String?
  model                        String?
  standards                    String[]                       @default([])
  fireRating                   String?
  keyProps                     String[]                       @default([])
  aliases                      String[]                       @default([])
  properties                   Json?
  version                      Int                            @default(1)
  versionLabel                 String?
  versionMajor                 Int                            @default(1)
  versionMinor                 Int                            @default(0)
  versionPatch                 Int                            @default(0)
  notes                        String?
  status                       String                         @default("Active")
  createdAt                    DateTime                       @default(now()) @db.Timestamptz(6)
  updatedAt                    DateTime                       @updatedAt @db.Timestamptz(6)
  activityUses                 RefActivityMaterial[]
  RefChecklistItemMaterialLink RefChecklistItemMaterialLink[]

  @@index([name, category])
  @@index([discipline, category, manufacturer])
  @@map("RefMaterial")
}

model RefActivityMaterial {
  id         String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  activityId String      @db.Uuid
  materialId String      @db.Uuid
  note       String?
  activity   RefActivity @relation(fields: [activityId], references: [id], onDelete: Cascade)
  material   RefMaterial @relation(fields: [materialId], references: [id])

  @@unique([activityId, materialId], map: "refactmat_activity_material_uq")
  @@index([activityId])
  @@index([materialId])
  @@map("RefActivityMaterial")
}

model ProjectModuleSetting {
  id        String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  projectId String     @db.Uuid
  module    ModuleCode
  extra     Json
  createdAt DateTime   @default(now()) @db.Timestamptz(6)
  updatedAt DateTime   @updatedAt @db.Timestamptz(6)
  project   Project    @relation(fields: [projectId], references: [projectId], onDelete: Cascade)

  @@unique([projectId, module], map: "pms_project_module_unique")
  @@index([projectId])
  @@map("ProjectModuleSetting")
}

model AdminAuditSetting {
  id                 Int      @id @default(1)
  assignmentsEnabled Boolean  @default(true)
  updatedByUserId    String?  @db.Uuid
  updatedByName      String?
  updatedAt          DateTime @updatedAt @db.Timestamptz(6)

  @@map("AdminAuditSetting")
}

model AdminAuditLog {
  id           String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  actorUserId  String      @db.Uuid
  actorName    String
  action       AuditAction
  module       String      @default("Assignments")
  targetUserId String      @db.Uuid
  role         UserRole?
  scopeType    RoleScope?
  companyId    String?     @db.Uuid
  projectId    String?     @db.Uuid
  ip           String?
  userAgent    String?
  before       Json?
  after        Json?
  createdAt    DateTime    @default(now()) @db.Timestamptz(6)

  @@index([targetUserId, createdAt])
  @@index([companyId])
  @@index([projectId])
  @@index([action])
  @@map("AdminAuditLog")
}

model Wir {
  wirId                   String                   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code                    String?                  @unique
  title                   String
  projectId               String                   @db.Uuid
  status                  WirStatus                @default(Draft)
  health                  ProjectHealth            @default(Unknown)
  discipline              Discipline?
  stage                   String?
  forDate                 DateTime?                @db.Timestamptz(6)
  forTime                 String?
  rescheduleForDate       DateTime?                @db.Timestamptz(6)
  rescheduleForTime       String?
  rescheduleReason        String?
  rescheduledById         String?                  @db.Uuid
  cityTown                String?
  stateName               String?
  contractorId            String?                  @db.Uuid
  inspectorId             String?                  @db.Uuid
  hodId                   String?                  @db.Uuid
  bicUserId               String?                  @db.Uuid
  description             String?
  inspectorRecommendation InspectorRecommendation?
  inspectorRemarks        String?
  inspectorReviewedAt     DateTime?                @db.Timestamptz(6)
  hodOutcome              HodOutcome?
  hodRemarks              String?
  hodDecidedAt            DateTime?                @db.Timestamptz(6)

  // ---- NEW: versioning ----
  seriesId  String? @db.Uuid
  version   Int?    @default(1)
  prevWirId String? @db.Uuid

  // ---- NEW: Activity snapshot ----
  activityRefId           String? @db.Uuid
  activitySnapshot        Json?
  activitySnapshotVersion Int?

  // ---- NEW: materialization lifecycle ----
  materialized Boolean?  @default(false)
  snapshotAt   DateTime? @db.Timestamptz(6)

  createdById String?  @db.Uuid
  createdAt   DateTime @default(now()) @db.Timestamptz(6)
  updatedAt   DateTime @updatedAt @db.Timestamptz(6)

  bic           User?   @relation("WirBicUser", fields: [bicUserId], references: [userId])
  contractor    User?   @relation("WirContractorUser", fields: [contractorId], references: [userId])
  createdBy     User?   @relation("WirCreatedBy", fields: [createdById], references: [userId])
  hod           User?   @relation("WirHodUser", fields: [hodId], references: [userId])
  inspector     User?   @relation("WirInspectorUser", fields: [inspectorId], references: [userId])
  project       Project @relation(fields: [projectId], references: [projectId], onDelete: Cascade)
  rescheduledBy User?   @relation("WirRescheduledByUser", fields: [rescheduledById], references: [userId])

  checklists    WirChecklist[]
  WirDiscussion WirDiscussion[]
  histories     WirHistory[]      @relation("WirToHistory")
  items         WirItem[]
  evidences     WirItemEvidence[] @relation("WirToEvidence")
  itemRuns      WirItemRun[]      @relation("WirToItemRuns")

  @@index([activityRefId])
  @@index([seriesId, version])
  @@index([projectId])
  @@index([status])
  @@index([discipline, stage])
  @@index([bicUserId])
  @@map("Wir")
}

model WirChecklist {
  id             String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  wirId          String       @db.Uuid
  checklistId    String       @db.Uuid
  checklistCode  String?
  checklistTitle String?
  discipline     Discipline?
  versionLabel   String?
  itemsTotal     Int          @default(0)
  itemIds        String[]     @default([])
  itemsCount     Int?
  order          Int          @default(0)
  checklist      RefChecklist @relation(fields: [checklistId], references: [id])
  wir            Wir          @relation(fields: [wirId], references: [wirId], onDelete: Cascade)

  @@unique([wirId, checklistId], map: "wir_checklist_unique")
  @@index([wirId])
  @@index([checklistId])
  @@map("WirChecklist")
}

model WirItem {
  id                    String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  wirId                 String               @db.Uuid
  checklistId           String?              @db.Uuid
  itemId                String?              @db.Uuid
  seq                   Int?
  name                  String
  spec                  String?
  required              String?
  tolerance             String?
  photoCount            Int?
  status                WirItemStatus        @default(Unknown)
  createdAt             DateTime             @default(now()) @db.Timestamptz(6)
  updatedAt             DateTime             @updatedAt @db.Timestamptz(6)
  inspectorStatus       InspectorItemStatus?
  inspectorNote         String?
  hodStatus             InspectorItemStatus?
  hodNote               String?
  sourceChecklistId     String?              @db.Uuid
  sourceChecklistItemId String?              @db.Uuid
  code                  String?
  unit                  String?
  tags                  String[]             @default([])
  critical              Boolean?
  aiEnabled             Boolean?
  aiConfidence          Decimal?             @db.Decimal(8, 3)
  base                  Decimal?             @db.Decimal(18, 3)
  plus                  Decimal?             @db.Decimal(18, 3)
  minus                 Decimal?             @db.Decimal(18, 3)

  checklist       RefChecklist?     @relation("WirItem_checklist", fields: [checklistId], references: [id], onDelete: Restrict)
  item            RefChecklistItem? @relation("WirItem_item", fields: [itemId], references: [id], onDelete: Restrict)
  sourceChecklist RefChecklist?     @relation("WirItem_sourceChecklist", fields: [sourceChecklistId], references: [id])
  sourceItem      RefChecklistItem? @relation("WirItem_sourceItem", fields: [sourceChecklistItemId], references: [id])
  wir             Wir               @relation(fields: [wirId], references: [wirId], onDelete: Cascade)

  evidences WirItemEvidence[] @relation("WirItemToEvidence")
  runs      WirItemRun[]      @relation("WirItemToRuns")

  @@index([wirId])
  @@index([checklistId])
  @@index([itemId])
  @@index([sourceChecklistId])
  @@index([sourceChecklistItemId])
  @@map("WirItem")
}

model WirHistory {
  id            String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  projectId     String     @db.Uuid
  wirId         String     @db.Uuid
  action        WirAction
  actorUserId   String?    @db.Uuid
  actorName     String?
  fromStatus    WirStatus?
  toStatus      WirStatus?
  fromBicUserId String?    @db.Uuid
  toBicUserId   String?    @db.Uuid
  notes         String?
  meta          Json?
  createdAt     DateTime   @default(now()) @db.Timestamptz(6)
  wir           Wir        @relation("WirToHistory", fields: [wirId], references: [wirId], onDelete: Cascade)

  @@index([wirId, createdAt], map: "wirhist_wir_created_idx")
  @@index([projectId, createdAt], map: "wirhist_project_created_idx")
  @@map("WirHistory")
}

model WirDiscussion {
  id        String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  wirId     String    @db.Uuid
  authorId  String    @db.Uuid
  parentId  String?   @db.Uuid
  body      String
  fileUrl   String?
  fileName  String?
  createdAt DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt DateTime  @updatedAt @db.Timestamptz(6)
  deletedAt DateTime?

  author  User            @relation(fields: [authorId], references: [userId], onDelete: Cascade)
  parent  WirDiscussion?  @relation("WirDiscussionToParent", fields: [parentId], references: [id])
  replies WirDiscussion[] @relation("WirDiscussionToParent")
  wir     Wir             @relation(fields: [wirId], references: [wirId], onDelete: Cascade)
}

model WirItemRun {
  id           String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  wirId        String              @db.Uuid
  itemId       String              @db.Uuid
  actorUserId  String?             @db.Uuid
  actorRole    WirRunnerActorRole?
  actorName    String?
  valueText    String?
  valueNumber  Decimal?            @db.Decimal(18, 3)
  unit         String?
  status       WirItemStatus?
  comment      String?
  lat          Decimal?            @db.Decimal(9, 6)
  lng          Decimal?            @db.Decimal(9, 6)
  accuracyM    Decimal?            @db.Decimal(6, 2)
  locationNote String?
  meta         Json?
  createdAt    DateTime            @default(now()) @db.Timestamptz(6)

  evidences WirItemEvidence[] @relation("RunToEvidence")
  item      WirItem           @relation("WirItemToRuns", fields: [itemId], references: [id], onDelete: Cascade)
  wir       Wir               @relation("WirToItemRuns", fields: [wirId], references: [wirId], onDelete: Cascade)

  @@index([wirId])
  @@index([itemId])
  @@index([actorUserId])
  @@map("WirItemRun")
}

model WirItemEvidence {
  id         String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  wirId      String              @db.Uuid
  itemId     String?             @db.Uuid
  runId      String?             @db.Uuid
  kind       WirItemEvidenceKind @default(Photo)
  url        String
  thumbUrl   String?
  fileName   String?
  fileSize   Int?
  mimeType   String?
  capturedAt DateTime?           @db.Timestamptz(6)
  lat        Decimal?            @db.Decimal(9, 6)
  lng        Decimal?            @db.Decimal(9, 6)
  accuracyM  Decimal?            @db.Decimal(6, 2)
  meta       Json?
  createdAt  DateTime            @default(now()) @db.Timestamptz(6)

  item WirItem?    @relation("WirItemToEvidence", fields: [itemId], references: [id])
  run  WirItemRun? @relation("RunToEvidence", fields: [runId], references: [id])
  wir  Wir         @relation("WirToEvidence", fields: [wirId], references: [wirId], onDelete: Cascade)

  @@index([wirId])
  @@index([itemId])
  @@index([runId])
  @@map("WirItemEvidence")
}

enum PreferredLanguage {
  en
  hi
  bn
  ta
  te
  mr
  pa
  or
  gu
  kn
  ml

  @@map("PreferredLanguage")
}

enum OperatingZone {
  NCR
  North
  South
  East
  West
  Central

  @@map("OperatingZone")
}

enum UserStatus {
  Active
  Inactive

  @@map("UserStatus")
}

enum CompanyStatus {
  Active
  Inactive

  @@map("CompanyStatus")
}

enum UserRole {
  Admin
  Client
  IH_PMT     @map("IH-PMT")
  Contractor
  Consultant
  PMC
  Supplier

  @@map("UserRole")
}

enum CompanyRole {
  IH_PMT     @map("IH-PMT")
  Contractor
  Consultant
  PMC
  Supplier

  @@map("CompanyRole")
}

enum StateType {
  State
  UT

  @@map("StateType")
}

enum ProjectStatus {
  Draft
  Active
  OnHold
  Completed
  Archived

  @@map("project_status")
}

enum ProjectStage {
  Planning
  Design
  Procurement
  Execution
  Handover
  Closed

  @@map("project_stage")
}

enum ProjectType {
  Residential
  Commercial
  Industrial
  Institutional
  MixedUse
  Infrastructure
  Other

  @@map("project_type")
}

enum StructureType {
  LowRise
  HighRise
  Villa
  RowHouse
  InteriorFitout
  ShellCore
  Other

  @@map("structure_type")
}

enum ConstructionType {
  New
  Renovation
  Retrofit
  Repair
  Fitout
  Other

  @@map("construction_type")
}

enum ContractType {
  LumpSum
  ItemRate
  Turnkey
  EPC
  PMC
  LabourOnly
  Other

  @@map("contract_type")
}

enum ProjectHealth {
  Green
  Amber
  Red
  Unknown

  @@map("project_health")
}

enum CurrencyCode {
  INR
  USD
  EUR
  GBP
  AED
  SAR
  SGD
  AUD
  Other

  @@map("currency_code")
}

enum AreaUnit {
  SQFT
  SQM
  SQYD
  Acre
  Hectare

  @@map("area_unit")
}

enum RoleScope {
  Global
  Company
  Project

  @@map("RoleScope")
}

enum AuditAction {
  AssignAdded
  AssignRemoved
  AssignReplaced

  @@map("AuditAction")
}

enum ModuleCode {
  WIR

  @@map("ModuleCode")
}

enum WirStatus {
  Draft
  Submitted
  Recommended
  Approved
  Rejected
  Returned
  APPROVE_WITH_COMMENTS

  @@map("WirStatus")
}

enum WirItemStatus {
  OK
  NCR
  Pending
  Unknown

  @@map("WirItemStatus")
}

enum InspectorRecommendation {
  APPROVE
  APPROVE_WITH_COMMENTS
  REJECT
}

enum HodOutcome {
  ACCEPT
  RETURN
  REJECT
}

enum InspectorItemStatus {
  PASS
  FAIL
  NA
}

enum Discipline {
  Civil
  MEP
  Finishes

  @@map("Discipline")
}

enum MaterialDiscipline {
  Civil
  Architecture
  MEP_ELE      @map("MEP.ELE")
  MEP_PHE      @map("MEP.PHE")
  MEP_HVC      @map("MEP.HVC")
  Finishes

  @@map("MaterialDiscipline")
}

enum WirAction {
  Created
  Updated
  Submitted
  Recommended
  Approved
  Rejected
  Returned
  Deleted
  BicChanged
  ItemsChanged
  NoteAdded
  Rescheduled

  @@map("WirAction")
}

enum WirRunnerActorRole {
  Contractor
  Inspector
  HOD
  Other

  @@map("WirRunnerActorRole")
}

enum WirItemEvidenceKind {
  Photo
  Video
  File
  Other

  @@map("WirItemEvidenceKind")
}
